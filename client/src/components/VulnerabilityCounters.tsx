import { useEffect, useState } from "react";

export interface VulnerabilityStats {
  critical: number;
  high: number;
  medium: number;
  low: number;
}

interface VulnerabilityCountersProps {
  stats: VulnerabilityStats;
}

export function VulnerabilityCounters({ stats }: VulnerabilityCountersProps) {
  const [pulseKey, setPulseKey] = useState<string | null>(null);

  useEffect(() => {
    // Trigger pulse animation on any change
    setPulseKey(`${Date.now()}`);
  }, [stats.critical, stats.high, stats.medium, stats.low]);

  const CounterCard = ({ 
    label, 
    value, 
    color, 
    bgColor,
    icon 
  }: { 
    label: string; 
    value: number; 
    color: string; 
    bgColor: string;
    icon: string;
  }) => (
    <div
      key={`${label}-${pulseKey}`}
      style={{
        flex: 1,
        padding: "0.75rem",
        backgroundColor: bgColor,
        border: `2px solid ${color}`,
        borderRadius: "0.375rem",
        textAlign: "center",
        animation: "pulse 0.6s ease-in-out",
      }}
    >
      <div style={{ fontSize: "1rem", marginBottom: "0.25rem" }}>{icon}</div>
      <div style={{ color, fontSize: "0.75rem", fontWeight: "bold", textTransform: "uppercase" }}>
        {label}
      </div>
      <div style={{ color, fontSize: "1.5rem", fontWeight: "bold", marginTop: "0.25rem" }}>
        {value}
      </div>
    </div>
  );

  return (
    <>
      <style>{`
        @keyframes pulse {
          0% {
            transform: scale(1);
            box-shadow: 0 0 0 0 currentColor;
          }
          50% {
            transform: scale(1.05);
          }
          100% {
            transform: scale(1);
            box-shadow: 0 0 0 8px rgba(255, 255, 255, 0);
          }
        }
      `}</style>
      
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(4, 1fr)",
          gap: "0.75rem",
          marginBottom: "1rem",
          fontFamily: "'Fira Code', monospace",
        }}
      >
        <CounterCard
          label="Critical"
          value={stats.critical}
          icon="â˜¢ï¸"
          color="#FF0033"
          bgColor="rgba(255, 0, 51, 0.15)"
        />
        <CounterCard
          label="High"
          value={stats.high}
          icon="ðŸ”¥"
          color="#FF6B35"
          bgColor="rgba(255, 107, 53, 0.15)"
        />
        <CounterCard
          label="Medium"
          value={stats.medium}
          icon="ðŸŸ¡"
          color="#FFAA00"
          bgColor="rgba(255, 170, 0, 0.15)"
        />
        <CounterCard
          label="Low"
          value={stats.low}
          icon="ðŸ›¡ï¸"
          color="#00FF00"
          bgColor="rgba(0, 255, 0, 0.15)"
        />
      </div>
    </>
  );
}
